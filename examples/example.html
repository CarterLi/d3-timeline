<!doctype html>
<html>
<head>
  <script src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
  <script src="../src/d3-timeline.js"></script>

  <style type="text/css">
    .axis path,
    .axis line,
    .line line,
    .top-line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }

    .axis text,
    .line text {
      font-family: sans-serif;
      font-size: 10px;
      stroke: none;
    }

    .timeline-label {
      font-family: sans-serif;
      font-size: 12px;
    }

    #timeline2 .axis {
      transform: translate(0px,40px);
    }

    .coloredDiv {
      height:20px; width:20px; float:left;
    }

    .hidden {
      display: none;
    }

    .line {
      stroke: black;
    }

    .line circle {
      fill: #eee;
    }

    .line .label {
      text-anchor: middle;
    }
  </style>
  <script type="text/javascript">
    window.onload = function() {
      var iconTestData = [
        {label: 'Jackie', class:'jackie', icon: 'jackie.png', times: [
          {'starting_time': 1355752800000, 'ending_time': 1355759900000},
          {'starting_time': 1355767900000, 'ending_time': 1355774400000}]},
        {label: 'Troll', class:'troll', icon: 'troll.png', times: [
          {'starting_time': 1355759910000, 'ending_time': 1355761900000}]},
        {label: 'Wat', class:'wat', icon: 'wat.png', times: [
          {'starting_time': 1355761910000, 'ending_time': 1355763910000}]}
      ];

      void function timelineStackedIcons() {
        var chart = d3.timeline()
          .beginning(1355752800000)
          .ending(1355774400000)
          .showTimeAxisTick()
          .stack()
          .margin({left:70, right:30, top:0, bottom:0})
          .background('#eee')
          .rowSeparators('red');
        const format = d3.time.format("%X")
        var svg = d3.select('#timeline').append('svg').attr('width', 1000)
          .datum(iconTestData).call(chart).on('mousemove', function() {
          const [x, y] = d3.mouse(this);
          const { left , right } = chart.margin()
          if ((x >= left && x <= chart.width() - right) && (y >= 25 && y <= chart.height() - 25)) {
            line.classed('hidden', false);
          } else {
            line.classed('hidden', true);
            return;
          }

          line.attr('transform', `translate(${x} 0)`)
            .select('.label').text(format(new Date(xrScale(x))));
        });
        var xrScale = d3.time.scale()
          .domain([chart.margin().left, chart.width() - chart.margin().right])
          .range([chart.beginning(), chart.ending()]);

        const { left , right } = chart.margin()
        svg.append('line')
          .attr('class', 'top-line')
          .attr('x1', left)
          .attr('x2', chart.width() - right)
          .attr('y1', 25 - 2)
          .attr('y2', 25 - 2);

        var line = svg.append('g').attr('class', 'line hidden').call(g => {
          g.append('circle')
            .attr('cx', 0)
            .attr('cy', 25 - 2)
            .attr('r', 2);
          g.append('circle')
            .attr('cx', 0)
            .attr('cy', chart.height() - 25 + 1 + chart.itemMargin())
            .attr('r', 2);
          g.append('line')
            .attr('x1', 0)
            .attr('x2', 0)
            .attr('y1', 25)
            .attr('y2', chart.height() - 25 - 1 + chart.itemMargin());
          g.append('text')
            .attr('x', 2)
            .attr('y', 13)
            .attr('dy', '.71em')
            .text('Time');
          g.append('text')
            .attr('class', 'label')
            .attr('x', 0)
            .attr('y', chart.height() - 15 + chart.itemMargin())
            .attr('dy', '.71em')
            .text('? PM');
        });
      }();
    }
  </script>
</head>
<body>
  <div>
    <h3>Test</h3>
    <div id="timeline"></div>
  </div>
</body>
</html>
